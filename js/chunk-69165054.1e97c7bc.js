(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69165054"],{"6c69":function(e,t,n){"use strict";n.r(t);var o=n("7a23");const c={class:"form__table"},l={key:0},r=Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--pr15px"},[Object(o["createElementVNode"])("label",{class:"nowrap",for:"news-type"},[Object(o["createTextVNode"])("Это акция или "),Object(o["createElementVNode"])("br"),Object(o["createTextVNode"])("спецпредложение *")])],-1),a={class:"form__table-cell form__table-cell--wide"},i={class:"select"},s=Object(o["createElementVNode"])("option",{value:"action"},"Акция",-1),d=Object(o["createElementVNode"])("option",{value:"special"},"Спецпредложение",-1),u=[s,d],b={key:1},m=Object(o["createElementVNode"])("td",{class:"form__table-cell"},null,-1),p=Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--wide form__table-cell--pb10px"},[Object(o["createElementVNode"])("small",{class:"control-description",id:"news-type-disc"},"Поле обязательно к заполнению")],-1),f=[m,p],j=Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--pr15px"},[Object(o["createElementVNode"])("label",{class:"nowrap",for:"news-preview"},"Превью новости *")],-1),O={class:"form__table-cell form__table-cell--wide"},v={key:0,class:"control-error"},y=Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",{class:"form__table-cell"}),Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--wide form__table-cell--pb10px"},[Object(o["createElementVNode"])("small",{class:"control-description",id:"news-preview-disc"},"Поле обязательно к заполнению")])],-1),V=Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--pr15px"},[Object(o["createElementVNode"])("label",{class:"nowrap",for:"news-text"},"Текст новости *")],-1),w={class:"form__table-cell form__table-cell--wide"},N={key:0,class:"control-error"},_=Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",{class:"form__table-cell"}),Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--wide form__table-cell--pb10px"},[Object(o["createElementVNode"])("small",{class:"control-description",id:"news-text-disc"},"Поле обязательно к заполнению")])],-1),E=Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",{class:"form__table-cell"},[Object(o["createElementVNode"])("label",{class:"nowrap",for:"news-title"})]),Object(o["createElementVNode"])("td",{class:"form__table-cell form__table-cell--wide"})],-1),g=Object(o["createElementVNode"])("td",{class:"form__table-cell"},null,-1),h={class:"form__table-cell form__table-cell--wide"},k={class:"row"},C={class:"col-auto"},S=["disabled"],x={key:0,class:"col-auto"},B={key:1,class:"col-auto"};function D(e,t,n,s,d,m){const p=Object(o["resolveComponent"])("news-input-row"),D=Object(o["resolveComponent"])("editor"),$=Object(o["resolveComponent"])("router-link");return Object(o["openBlock"])(),Object(o["createElementBlock"])("form",{action:"#",id:"news",class:"form",onSubmit:t[5]||(t[5]=Object(o["withModifiers"])((...e)=>s.onSubmit&&s.onSubmit(...e),["prevent"]))},[Object(o["createElementVNode"])("table",c,[Object(o["createElementVNode"])("tbody",null,["specials_and_actions"===s.tableName?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",l,[r,Object(o["createElementVNode"])("td",a,[Object(o["createElementVNode"])("div",i,[Object(o["withDirectives"])(Object(o["createElementVNode"])("select",{name:"news-type",id:"news-type",class:"select__select","onUpdate:modelValue":t[0]||(t[0]=e=>s.article.type=e),"aria-describedby":"news-type-disc"},u,512),[[o["vModelSelect"],s.article.type]])])])])):Object(o["createCommentVNode"])("",!0),"specials_and_actions"===s.tableName?(Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",b,f)):Object(o["createCommentVNode"])("",!0),Object(o["createVNode"])(p,{formName:"news",inputName:"news-img",label:"Ссылку на картинку",description:"Поле НЕобязательно к заполнению.\r\n          Картинка в формате jpg, png, svg, webp. Размер картинки не более 800*800px.\r\n          <br> Вес картинки не более 2Мб",controlValue:s.article.img,"onUpdate:controlValue":t[1]||(t[1]=e=>s.article.img=e),errors:[]},null,8,["controlValue"]),Object(o["createVNode"])(p,{formName:"news",inputName:"news-title",label:"Заголовок новости *",description:"Поле обязательно к заполнению",controlValue:s.article.title,"onUpdate:controlValue":t[2]||(t[2]=e=>s.article.title=e),errors:s.v$.title.$errors},null,8,["controlValue","errors"]),Object(o["createElementVNode"])("tr",null,[j,Object(o["createElementVNode"])("td",O,[Object(o["createVNode"])(D,{modelValue:s.article.preview,"onUpdate:modelValue":t[3]||(t[3]=e=>s.article.preview=e),"api-key":s.tinymceKey},null,8,["modelValue","api-key"]),s.v$.preview.$errors.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",v,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(s.v$.preview.$errors,e=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createElementVNode"])("div",null,Object(o["toDisplayString"])(e.$message),1)]))),256))])):Object(o["createCommentVNode"])("",!0)])]),y,Object(o["createElementVNode"])("tr",null,[V,Object(o["createElementVNode"])("td",w,[Object(o["createVNode"])(D,{modelValue:s.article.text,"onUpdate:modelValue":t[4]||(t[4]=e=>s.article.text=e),"api-key":s.tinymceKey},null,8,["modelValue","api-key"]),s.v$.text.$errors.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",N,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(s.v$.text.$errors,e=>(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createElementVNode"])("div",null,Object(o["toDisplayString"])(e.$message),1)]))),256))])):Object(o["createCommentVNode"])("",!0)])]),_,E,Object(o["createElementVNode"])("tr",null,[g,Object(o["createElementVNode"])("td",h,[Object(o["createElementVNode"])("div",k,[Object(o["createElementVNode"])("div",C,[Object(o["createElementVNode"])("button",{type:"submit",disabled:s.isLoading,class:Object(o["normalizeClass"])(["button",{"is-loading":s.isLoading}])},"Отправить",10,S)]),s.needShowButtons?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",x,[Object(o["createVNode"])($,{to:"/"+s.tableName+"/"+s.fbId,class:"button"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("Посмотреть статью")]),_:1},8,["to"])])):Object(o["createCommentVNode"])("",!0),s.needShowButtons?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",B,[Object(o["createVNode"])($,{to:"/"+s.tableName+"/edit/"+s.fbId,class:"button"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("Редактировать статью")]),_:1},8,["to"])])):Object(o["createCommentVNode"])("",!0)])])])])])],32)}var $=n("5502"),A=n("6605"),L=n("c3b3"),M=n("b9fb"),U=n("ca72"),I=n("8edc"),P={name:"ArticleAdd",setup(){const e=Object($["e"])(),t=Object(A["c"])(),n=t.meta.tableName,c={img:"",title:"",preview:"",text:"",date:null,tableName:n},l={title:{required:M["c"]},preview:{required:M["c"]},text:{required:M["c"]},tableName:{required:M["c"]}};"specials_and_actions"===n&&(c.type="action",l.type={required:M["c"]});const r=Object(o["reactive"])({...c}),a=Object(o["ref"])(!1),i=Object(o["ref"])(!1),s=Object(o["ref"])(""),d="7iaejq0tnr1x4prtla31ao35f0mcyy7avktxha787dhulfac",u=Object(L["a"])(l,r),b=Object(o["computed"])(()=>!!i.value&&!(r.img||r.title||r.preview||r.text)),m=()=>{Object.keys(r).map(e=>r[e]=c[e]),u.value.$reset()},p=async()=>{if(u.value.$touch(),u.value.$error)return;a.value=!0,r.date=new Date;const t=await e.dispatch("news/createNews",r);t.result?(i.value=!0,s.value=t.data.name,m(),e.dispatch("alerts/alertAdd",{id:Date.now(),text:`Статья успешно создана. <br>\n            Перейти к\n            <a href="/${n}/${s.value}" class="js-click-push">просмотру</a>.<br>\n            Перейти к <a href="/${n}/">списку всех статей</a>.`,type:"success",closable:!0,autoClosable:!1})):e.dispatch("alerts/alertAdd",{id:Date.now(),text:"Ошибка ответа от сервера при добавлении новой новости",type:"error",closable:!0,autoClosable:!1}),a.value=!1};return{v$:u,fbId:s,article:r,isLoading:a,needShowButtons:b,tinymceKey:d,tableName:n,onSubmit:p}},components:{Editor:U["a"],NewsInputRow:I["a"]}},K=n("6b0d"),R=n.n(K);const F=R()(P,[["render",D]]);t["default"]=F},c4a9:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var o=function(){return"undefined"!==typeof window?window:e},c=function(){var e=o();return e&&e.tinymce?e.tinymce:null}}).call(this,n("c8ba"))},ca72:function(e,t,n){"use strict";var o=n("7a23"),c=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],l=function(e){return-1!==c.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},r=function(e,t,n){Object.keys(t).filter(l).forEach((function(o){var c=t[o];"function"===typeof c&&("onInit"===o?c(e,n):n.on(o.substring(2),(function(e){return c(e,n)})))}))},a=function(e,t,n,c){var l=e.modelEvents?e.modelEvents:null,r=Array.isArray(l)?l.join(" "):l;Object(o["watch"])(c,(function(t,o){n&&"string"===typeof t&&t!==o&&t!==n.getContent({format:e.outputFormat})&&n.setContent(t)})),n.on(r||"change input undo redo",(function(){t.emit("update:modelValue",n.getContent({format:e.outputFormat}))}))},i=function(e,t,n,o,c,l){o.setContent(l()),n.attrs["onUpdate:modelValue"]&&a(t,n,o,c),r(e,n.attrs,o)},s=0,d=function(e){var t=Date.now(),n=Math.floor(1e9*Math.random());return s++,e+"_"+n+s+String(t)},u=function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()},b=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},m=function(e,t){return b(e).concat(b(t))},p=function(e){return null===e||void 0===e},f=function(){return{listeners:[],scriptId:d("tiny-script"),scriptLoaded:!1}},j=function(){var e=f(),t=function(e,t,n,o){var c=t.createElement("script");c.referrerPolicy="origin",c.type="application/javascript",c.id=e,c.src=n;var l=function(){c.removeEventListener("load",l),o()};c.addEventListener("load",l),t.head&&t.head.appendChild(c)},n=function(n,o,c){e.scriptLoaded?c():(e.listeners.push(c),n.getElementById(e.scriptId)||t(e.scriptId,n,o,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0})))},o=function(){e=f()};return{load:n,reinitialize:o}},O=j(),v=n("c4a9"),y={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},V=function(){return V=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var c in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e},V.apply(this,arguments)},w=function(e,t,n,o){return e(o||"div",{id:t,ref:n})},N=function(e,t,n){return e("textarea",{id:t,visibility:"hidden",ref:n})},_=Object(o["defineComponent"])({props:y,setup:function(e,t){var n=e.init?V({},e.init):{},c=Object(o["toRefs"])(e),l=c.disabled,r=c.modelValue,a=c.tagName,s=Object(o["ref"])(null),b=null,f=e.id||d("tiny-vue"),j=e.init&&e.init.inline||e.inline,y=!!t.attrs["onUpdate:modelValue"],_=!0,E=e.initialValue?e.initialValue:"",g="",h=function(e){return y?function(){return(null===r||void 0===r?void 0:r.value)?r.value:""}:function(){return e?E:g}},k=function(){var o=h(_),c=V(V({},n),{readonly:e.disabled,selector:"#"+f,plugins:m(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:j,setup:function(c){b=c,c.on("init",(function(n){return i(n,e,t,c,r,o)})),"function"===typeof n.setup&&n.setup(c)}});u(s.value)&&(s.value.style.visibility=""),Object(v["a"])().init(c),_=!1};Object(o["watch"])(l,(function(e){var t;null!==b&&("function"===typeof(null===(t=b.mode)||void 0===t?void 0:t.set)?b.mode.set(e?"readonly":"design"):b.setMode(e?"readonly":"design"))})),Object(o["watch"])(a,(function(e){var t;y||(g=b.getContent()),null===(t=Object(v["a"])())||void 0===t||t.remove(b),Object(o["nextTick"])((function(){return k()}))})),Object(o["onMounted"])((function(){if(null!==Object(v["a"])())k();else if(s.value&&s.value.ownerDocument){var t=e.cloudChannel?e.cloudChannel:"5",n=e.apiKey?e.apiKey:"no-api-key",o=p(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+n+"/tinymce/"+t+"/tinymce.min.js":e.tinymceScriptSrc;O.load(s.value.ownerDocument,o,k)}})),Object(o["onBeforeUnmount"])((function(){null!==Object(v["a"])()&&Object(v["a"])().remove(b)})),j||(Object(o["onActivated"])((function(){_||k()})),Object(o["onDeactivated"])((function(){var e;y||(g=b.getContent()),null===(e=Object(v["a"])())||void 0===e||e.remove(b)})));var C=function(e){var t;g=b.getContent(),null===(t=Object(v["a"])())||void 0===t||t.remove(b),n=V(V({},n),e),Object(o["nextTick"])((function(){return k()}))};return t.expose({rerender:C}),function(){return j?w(o["h"],f,s,e.tagName):N(o["h"],f,s)}}});t["a"]=_}}]);
//# sourceMappingURL=chunk-69165054.1e97c7bc.js.map